在Lua中字符串实际上是被**内化**（internalization）的一种数据。即每个存Lua字符串的变量，存的不是实际的字符串数据，而是该字符串数据的引用。

Lua内部字符串的工作原理：
	在Lua虚拟机中存在一个全局的数据区，用来存放当前系统中所有的字符串。
	Lua虚拟机用散列桶来管理字符串。
	每当我们创建一个新的字符串，Lua会先到桶里去找是否存在该字符串（比较），存在则直接引用，不存在则创建新的字符串数据，根据散列算法放入散列桶里。如果该散列值已经被其他String占用，则用链表串联起来，串到它的后面去。
	用散列表+链表的方式来存储数据通常都会存在某些散列值的链表特别长，使得查找变成线性的查找过程（更久），需要重新散列（rehash）。（当数据多的时候扩大桶，当数据少的时候缩小桶）

### 优点
- 由于是用散列桶来存储字符串数据，因此进行字符串数据的比较和查找操作时，性能会提升不少。因为传统的字符串比较算法是根据字符串长度逐位来进行对比，而Lua在已知字符串散列值的情况下，只需要进行一次整数的比较即可。
- 空间优化：多份相同的字符串在整个系统中只存在一个副本。

### 缺点
- 每次创建字符串都需要查找一次是否存在当前字符串，不存在才创建。好在多一次查找的操作消耗并不算大。

![[14 数据结构]]