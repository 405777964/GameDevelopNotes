阴影映射(Shadow Mapping)背后的思路非常简单：我们以**光的位置为视角**进行渲染，我们**能看到的东西都将被点亮**，**看不见的一定是在阴影之中**了。假设有一个地板，在光源和它之间有一个大盒子。由于光源处向光线方向看去，可以看到这个盒子，但看不到地板的一部分，这部分就应该在阴影中了。

![Untitled](渲染/渲染管线流程/阴影映射%20Shadow%20Mapping/Untitled.png)

## 阴影贴图

我们从光源的透视图来渲染场景，并把==深度值==的结果储存到纹理中，通过这种方式，我们就能对光源的透视图所见的最近的深度值进行采样。最终，深度值就会显示从光源的透视图下见到的第一个片段了。我们管储存在纹理中的所有这些深度值，叫做深度贴图（depth map）或阴影贴图。

![Untitled](渲染/渲染管线流程/阴影映射%20Shadow%20Mapping/Untitled%201.png)

在右边的图中我们显示出同样的平行光和观察者。我们渲染一个点P¯处的片段，需要决定它是否在阴影中。我们先得使用T把P¯**变换到光源的坐标空间**里。既然点P¯是从光的透视图中看到的，**它的z坐标就对应于它的深度**，例子中这个值是0.9。使用点P¯在光源的坐标空间的坐标，我们可以索引深度贴图，来获得从光的视角中最近的可见深度，结果是点C¯，最近的深度是0.4。因为索引深度贴图的结果是一个小于点P¯的深度，我们可以断定P¯被挡住了，它在阴影中了。