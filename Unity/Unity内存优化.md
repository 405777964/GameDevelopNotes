#unity优化 
Unity内部由两个内存管理池：
- 堆内存（heap）主要用来存储较大的和存储时间较长的数据。
- 堆栈内存（stack）主要用来存储较小的和短暂的数据。

### 堆栈内存分配和回收
堆栈上的内存分配和回收十分快捷简单，因为堆栈只会存储短暂的或者较小的变量。内存分配和回收都以一种顺序和大小可控制的形式进行。

### 堆内存分配和回收
堆内存上的内存分配和存储相对而言更加复杂，其内存分配和回收顺序不可控。
![[Unity内存原理#^6ec959]]
### 何时会出发垃圾回收
- 堆内存上进行内存分配操作而内存不足的时候
- GC自动触发
- GC被强制执行
*意味着频繁在堆内存上进行内存分配和回收会触发频繁的GC操作*

## 降低GC的影响的方法
1. 减少GC的运行次数
2. 减少单次GC的运行时间
3. 将GC的运行时间延迟，避免在关键时候触发，如可在场景加载的时候调用GC

策略：
1. 重构游戏，减少堆内存的分配和引用的分配。更少的变量和引用会==减少GC操作中的检测个数==从而提高GC运行效率。
2. 降低堆内存分配和回收的频率（更少的事件触发GC操作）。

### 减少内存垃圾的数量
- **缓存**：在代码中反复调用操作堆内存分配的函数，我们可以缓存这些变量重复利用。（如GetComponent和每次操作都new新的数组）
- **不要在频繁调用的函数（如Update）里反复进行堆内存分配**
- **清空数据重复使用堆内存fen'pei**